<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test WebContainer Integration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 20px;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            background: #e3f2fd;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª WebContainer Integration Test</h1>
    
    <div class="test-container">
        <h2>Step 1: Load Design Tab</h2>
        <button onclick="loadDesignTab()">Load Design Tab</button>
        <div id="status1" class="status" style="display:none;"></div>
    </div>

    <div class="test-container">
        <h2>Step 2: Send Test Dyad Output</h2>
        <button onclick="sendTestDyadOutput()">Send Simple React App</button>
        <button onclick="sendComplexDyadOutput()">Send Complex App</button>
        <div id="status2" class="status" style="display:none;"></div>
    </div>

    <div class="test-container">
        <h2>Step 3: Test Element Selection</h2>
        <button onclick="testElementSelection()">Activate Element Picker</button>
        <div id="status3" class="status" style="display:none;"></div>
    </div>

    <div class="test-container">
        <h2>Preview:</h2>
        <iframe id="designFrame" src="about:blank"></iframe>
    </div>

    <script>
        const SIMPLE_DYAD_OUTPUT = `
<dyad-write path="src/App.tsx" description="Simple test app">
import React from 'react';

function App() {
  return (
    <div style={{ 
      minHeight: '100vh', 
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      color: 'white'
    }}>
      <div style={{ textAlign: 'center' }}>
        <h1 style={{ fontSize: '48px', marginBottom: '20px' }}>
          ðŸŽ‰ WebContainer Works!
        </h1>
        <p style={{ fontSize: '20px', opacity: 0.9 }}>
          Ghost + WebContainers = Amazing
        </p>
        <button style={{
          marginTop: '30px',
          padding: '12px 30px',
          fontSize: '18px',
          background: 'white',
          color: '#667eea',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer'
        }}>
          Click Me!
        </button>
      </div>
    </div>
  );
}

export default App;
</dyad-write>

<dyad-write path="src/main.tsx" description="Entry point">
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
</dyad-write>
`;

        const COMPLEX_DYAD_OUTPUT = `
<dyad-write path="src/App.tsx" description="Complex app with routing">
import React from 'react';
import { BrowserRouter as Router, Routes, Route, Link } from 'react-router-dom';
import HomePage from './pages/HomePage';
import AboutPage from './pages/AboutPage';

function App() {
  return (
    <Router>
      <div className="min-h-screen bg-gray-100">
        <nav className="bg-white shadow-lg">
          <div className="max-w-6xl mx-auto px-4">
            <div className="flex justify-between">
              <div className="flex space-x-7">
                <div className="flex items-center py-4">
                  <span className="font-semibold text-gray-500 text-lg">Ghost App</span>
                </div>
                <div className="flex items-center space-x-1">
                  <Link to="/" className="py-4 px-2 text-gray-500 font-semibold hover:text-blue-500">Home</Link>
                  <Link to="/about" className="py-4 px-2 text-gray-500 font-semibold hover:text-blue-500">About</Link>
                </div>
              </div>
            </div>
          </div>
        </nav>
        <Routes>
          <Route path="/" element={<HomePage />} />
          <Route path="/about" element={<AboutPage />} />
        </Routes>
      </div>
    </Router>
  );
}

export default App;
</dyad-write>

<dyad-write path="src/pages/HomePage.tsx" description="Home page">
import React, { useState } from 'react';

function HomePage() {
  const [count, setCount] = useState(0);

  return (
    <div className="container mx-auto mt-8 px-4">
      <h1 className="text-4xl font-bold text-gray-800 mb-4">Welcome to Ghost + WebContainers</h1>
      <p className="text-lg text-gray-600 mb-8">
        This is a complex React app running entirely in your browser!
      </p>
      
      <div className="bg-white rounded-lg shadow-md p-6 max-w-md">
        <h2 className="text-2xl font-semibold mb-4">Interactive Counter</h2>
        <p className="text-3xl font-bold text-blue-600 mb-4">{count}</p>
        <div className="space-x-2">
          <button 
            onClick={() => setCount(count + 1)}
            className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          >
            Increment
          </button>
          <button 
            onClick={() => setCount(count - 1)}
            className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
          >
            Decrement
          </button>
          <button 
            onClick={() => setCount(0)}
            className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
          >
            Reset
          </button>
        </div>
      </div>
    </div>
  );
}

export default HomePage;
</dyad-write>

<dyad-write path="src/pages/AboutPage.tsx" description="About page">
import React from 'react';

function AboutPage() {
  return (
    <div className="container mx-auto mt-8 px-4">
      <h1 className="text-4xl font-bold text-gray-800 mb-4">About</h1>
      <div className="bg-white rounded-lg shadow-md p-6">
        <p className="text-lg text-gray-600 mb-4">
          This application demonstrates the power of WebContainers technology.
        </p>
        <ul className="list-disc list-inside space-y-2 text-gray-600">
          <li>Full React/TypeScript support</li>
          <li>Hot module replacement</li>
          <li>npm package installation</li>
          <li>Running entirely in your browser</li>
          <li>No backend servers required</li>
        </ul>
      </div>
    </div>
  );
}

export default AboutPage;
</dyad-write>

<dyad-write path="src/main.tsx" description="Entry point">
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
</dyad-write>

<dyad-write path="src/index.css" description="Tailwind CSS">
@tailwind base;
@tailwind components;
@tailwind utilities;
</dyad-write>
`;

        function loadDesignTab() {
            const frame = document.getElementById('designFrame');
            frame.src = 'http://localhost:50002/webui/design-webcontainer.html';
            
            const status = document.getElementById('status1');
            status.style.display = 'block';
            status.textContent = 'âœ… Design tab loaded. Wait for WebContainer to initialize...';
        }

        function sendTestDyadOutput() {
            const frame = document.getElementById('designFrame');
            if (frame.contentWindow) {
                frame.contentWindow.postMessage({
                    type: 'load-dyad-output',
                    content: SIMPLE_DYAD_OUTPUT
                }, '*');
                
                const status = document.getElementById('status2');
                status.style.display = 'block';
                status.textContent = 'âœ… Sent simple React app. Watch the preview load...';
            }
        }

        function sendComplexDyadOutput() {
            const frame = document.getElementById('designFrame');
            if (frame.contentWindow) {
                frame.contentWindow.postMessage({
                    type: 'load-dyad-output',
                    content: COMPLEX_DYAD_OUTPUT
                }, '*');
                
                const status = document.getElementById('status2');
                status.style.display = 'block';
                status.textContent = 'âœ… Sent complex app with routing. This will take longer to load...';
            }
        }

        function testElementSelection() {
            const frame = document.getElementById('designFrame');
            if (frame.contentWindow) {
                // Toggle element picker
                frame.contentWindow.postMessage({
                    type: 'activate-selector'
                }, '*');
                
                const status = document.getElementById('status3');
                status.style.display = 'block';
                status.textContent = 'âœ… Element picker activated. Click any element in the preview!';
            }
        }

        // Listen for messages from design tab
        window.addEventListener('message', (event) => {
            console.log('Received message:', event.data);
            
            if (event.data.type === 'element-selected-for-editing') {
                alert('Element selected: ' + JSON.stringify(event.data.element, null, 2));
            }
        });
    </script>
</body>
</html>